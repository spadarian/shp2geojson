<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>shp2geojson Example</title>
    </head>
    <body>
        <div class="main">
            <div id="text">
                <p>This is a small demo on how to upload a .shp file and transform it to GeoJSON.</p>
                <p>If tou need a .shp file to test the demo, you can use <a href="chile.shp">this one</a>.</p>
            </div>
            <div id="map"></div>
            <input id="file_input" type="file" name="file" value="">
        </div>
    </body>
    <style>
        #map {
            height: 400px;
            width: 600px;
        }
        input {
            margin-top: 40px;
        }
    </style>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.26.0/mapbox-gl.css' rel='stylesheet' />
    <script src="shp2geojson.js" charset="utf-8"></script>
    <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoic3BhZGFyaWFuIiwiYSI6ImNpd250dHB2ODAwMDgydHBlYmVtZ3E0OXAifQ.MrgPejRnBiK9ZhRfbnSbeg';
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/mapbox/dark-v8', //stylesheet location
    });
    var input = document.getElementById('file_input');
    input.addEventListener('change', function(){
        var file = this.files[0];
        var filename = escape(file.name);
        var reader = new FileReader();
        // Read file into memory
        reader.readAsBinaryString(file);
        // Handle errors load
        reader.onload = function(e){
            return loadHandlerSHP(e);
        }

        function loadHandlerSHP(e) {
            var shp = e.target.result;
            var bin = new BinaryFile(shp);
            var shp_file = new ShpFile(bin)
            var data = shp_file.toGeoJSON();

            map.addSource(filename,data);
            map.addLayer({
                'id': filename,
                'interactive': false,
                'type': 'line',
                'source': filename,
                'paint': {
                    'line-color': '#f03b20'
                }
            });
        }

    })
    </script>
</html>
